<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIä»»åŠ¡ç®¡ç†</title>
    <style>
        /* å¼•å…¥Google Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        :root {
            /* ä¸»è‰²è°ƒ */
            --primary: #6366f1;
            --primary-hover: #4f46e5;
            --primary-light: #e0e7ff;
            
            /* è¾…åŠ©è‰² */
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --info: #3b82f6;
            --purple: #8b5cf6;
            --yellow: #fbbf24;
            --pink: #ec4899;
            
            /* ä¸­æ€§è‰² */
            --bg-primary: #ffffff;
            --bg-secondary: #f9fafb;
            --bg-tertiary: #f3f4f6;
            --border-color: #e5e7eb;
            --text-primary: #111827;
            --text-secondary: #6b7280;
            --text-tertiary: #9ca3af;
            
            /* é˜´å½± */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            
            /* åœ†è§’ */
            --radius-sm: 4px;
            --radius-md: 6px;
            --radius-lg: 8px;
            --radius-xl: 12px;
            --radius-full: 9999px;
            
            /* è¿‡æ¸¡æ•ˆæœ */
            --transition: all 0.2s ease-in-out;
        }
        
        body {
            background-color: var(--bg-secondary);
            min-height: 100vh;
            display: flex;
            font-size: 14px;
            color: var(--text-primary);
            overflow: hidden;
        }
        
        /* å·¦ä¾§å¯¼èˆªæ  */
        .sidebar {
            width: 220px;
            background-color: var(--bg-primary);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow-y: auto;
            transition: var(--transition);
            z-index: 10;
        }
        
        /* æ»šåŠ¨æ¡ç¾åŒ– */
        .sidebar::-webkit-scrollbar {
            width: 4px;
        }
        
        .sidebar::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
        }
        
        .sidebar::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: var(--radius-full);
        }
        
        .sidebar::-webkit-scrollbar-thumb:hover {
            background: var(--text-tertiary);
        }
        
        .sidebar-section {
            padding: 8px 0;
        }
        
        .sidebar-section-title {
            padding: 12px 16px 8px;
            font-size: 11px;
            font-weight: 600;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .sidebar-item {
            display: flex;
            align-items: center;
            padding: 10px 16px;
            color: var(--text-secondary);
            text-decoration: none;
            cursor: pointer;
            transition: var(--transition);
            border-radius: var(--radius-md);
            margin: 0 8px;
            position: relative;
        }
        
        .sidebar-item:hover {
            background-color: var(--bg-tertiary);
            color: var(--primary);
        }
        
        .sidebar-item.active {
            background-color: var(--primary-light);
            color: var(--primary);
        }
        
        .sidebar-item .icon {
            margin-right: 10px;
            font-size: 16px;
            transition: var(--transition);
        }
        
        /* å³ä¾§ä¸»å†…å®¹ */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }
        
        /* é¡¶éƒ¨åŠŸèƒ½æ  */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 24px;
            background-color: var(--bg-primary);
            border-bottom: 1px solid var(--border-color);
            height: 60px;
            position: sticky;
            top: 0;
            z-index: 5;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .menu-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            background: transparent;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            cursor: pointer;
            color: var(--text-secondary);
            transition: var(--transition);
        }
        
        .menu-toggle:hover {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
        }
        
        .search-container {
            display: flex;
            align-items: center;
            width: 320px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-full);
            padding: 8px 16px;
            transition: var(--transition);
        }
        
        .search-container:focus-within {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .search-container .icon {
            color: var(--text-tertiary);
            margin-right: 8px;
            font-size: 14px;
        }
        
        .search-container input {
            flex: 1;
            background: transparent;
            border: none;
            font-size: 14px;
            color: var(--text-primary);
            outline: none;
        }
        
        .search-container input::placeholder {
            color: var(--text-tertiary);
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .header-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-full);
            cursor: pointer;
            color: var(--text-secondary);
            transition: var(--transition);
        }
        
        .header-btn:hover {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
        }
        
        /* å†…å®¹åŒºåŸŸ */
        .content {
            flex: 1;
            overflow-y: auto;
            background: var(--bg-primary);
        }
        
        /* å†…å®¹åŒºåŸŸæ»šåŠ¨æ¡ */
        .content::-webkit-scrollbar {
            width: 8px;
        }
        
        .content::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
        }
        
        .content::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: var(--radius-full);
        }
        
        .content::-webkit-scrollbar-thumb:hover {
            background: var(--text-tertiary);
        }
        
        /* ä»»åŠ¡å¿«é€Ÿæ·»åŠ æ  */
        .quick-add-bar {
            padding: 16px 24px;
            border-bottom: 1px solid var(--border-color);
            background-color: var(--bg-primary);
        }
        
        .quick-add-container {
            display: flex;
            align-items: center;
            gap: 12px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 12px 16px;
            transition: var(--transition);
        }
        
        .quick-add-container:focus-within {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .quick-add-input {
            flex: 1;
            background: transparent;
            border: none;
            font-size: 14px;
            color: var(--text-primary);
            outline: none;
        }
        
        .quick-add-input::placeholder {
            color: var(--text-tertiary);
        }
        
        .quick-add-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .action-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            background: transparent;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            cursor: pointer;
            color: var(--text-secondary);
            transition: var(--transition);
        }
        
        .action-btn:hover {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
        }
        
        .add-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            background: var(--primary);
            border: none;
            border-radius: var(--radius-full);
            cursor: pointer;
            color: white;
            font-weight: 600;
            transition: var(--transition);
            font-size: 18px;
        }
        
        .add-btn:hover {
            background-color: var(--primary-hover);
            transform: scale(1.05);
        }
        
        /* ä»»åŠ¡åˆ—è¡¨åŒºåŸŸ */
        .tasks-section {
            padding: 24px;
            min-height: calc(100vh - 180px);
        }
        
        .no-tasks {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: calc(100vh - 220px);
            color: var(--text-tertiary);
            text-align: center;
        }
        
        .no-tasks h3 {
            font-size: 16px;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }
        
        .no-tasks p {
            font-size: 14px;
            color: var(--text-tertiary);
        }
        
        /* ä»»åŠ¡å¡ç‰‡ */
        .task-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 16px;
            margin-bottom: 12px;
            transition: var(--transition);
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }
        
        .task-card:hover {
            box-shadow: var(--shadow-md);
            border-color: var(--primary-light);
        }
        
        .task-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-full);
            cursor: pointer;
            transition: var(--transition);
            flex-shrink: 0;
            margin-top: 2px;
        }
        
        .task-checkbox:hover {
            border-color: var(--primary);
        }
        
        .task-checkbox.checked {
            background-color: var(--primary);
            border-color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
        }
        
        .task-info {
            flex: 1;
        }
        
        .task-title {
            font-size: 15px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 4px;
        }
        
        .task-title.completed {
            text-decoration: line-through;
            color: var(--text-tertiary);
        }
        
        .task-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .task-meta .icon {
            margin-right: 4px;
            font-size: 12px;
        }
        
        /* æ ‡ç­¾æ ·å¼ */
        .tag {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            border-radius: var(--radius-full);
            font-size: 11px;
            font-weight: 500;
            color: white;
        }
        
        .tag-work {
            background-color: var(--info);
        }
        
        .tag-life {
            background-color: var(--success);
        }
        
        .tag-study {
            background-color: var(--warning);
        }
        
        .tag-health {
            background-color: var(--error);
        }
        
        /* å›¾æ ‡æ ·å¼ */
        .icon {
            display: inline-block;
            width: 16px;
            height: 16px;
            text-align: center;
            line-height: 16px;
            transition: var(--transition);
        }
        
        /* è‡ªå®šä¹‰å›¾æ ‡ */
        .icon-ai::before {
            content: 'ğŸ¤–';
        }
        
        .icon-task::before {
            content: 'ğŸ“';
        }
        
        .icon-today::before {
            content: 'ğŸ“…';
        }
        
        .icon-calendar::before {
            content: 'ğŸ—“ï¸';
        }
        
        .icon-board::before {
            content: 'ğŸ“‹';
        }
        
        .icon-quadrant::before {
            content: 'ğŸ”„';
        }
        
        .icon-tomato::before {
            content: 'ğŸ…';
        }
        
        .icon-habit::before {
            content: 'âœ…';
        }
        
        .icon-stats::before {
            content: 'ğŸ“Š';
        }
        
        .icon-search::before {
            content: 'ğŸ”';
        }
        
        .icon-filter::before {
            content: 'âš™ï¸';
        }
        
        .icon-calendar-small::before {
            content: 'ğŸ“…';
        }
        
        .icon-tag::before {
            content: 'ğŸ·ï¸';
        }
        
        .icon-reminder::before {
            content: 'â°';
        }
        
        .icon-plus::before {
            content: '+';
            font-weight: bold;
        }
        
        /* AIåŠ©æ‰‹é¡µé¢ */
        .ai-assistant-page {
            padding: 24px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .ai-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
        }
        
        .ai-header h2 {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .ai-header .icon {
            font-size: 28px;
        }
        
        .ai-welcome {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 1px solid #fcd34d;
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-bottom: 24px;
        }
        
        .ai-welcome h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-primary);
        }
        
        .ai-welcome ul {
            list-style-type: none;
            padding-left: 0;
        }
        
        .ai-welcome li {
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
            color: var(--text-secondary);
        }
        
        .ai-welcome li::before {
            content: 'âœ¨';
            position: absolute;
            left: 0;
            top: 2px;
        }
        
        .ai-input-section {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 20px;
            box-shadow: var(--shadow-sm);
        }
        
        .ai-input-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .ai-input {
            width: 100%;
            min-height: 120px;
            padding: 16px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            transition: var(--transition);
        }
        
        .ai-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .ai-input-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .ai-example {
            font-size: 12px;
            color: var(--text-tertiary);
            font-style: italic;
        }
        
        .ai-send-btn {
            padding: 10px 24px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius-full);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .ai-send-btn:hover {
            background-color: var(--primary-hover);
            transform: translateY(-1px);
        }
        
        /* AIèŠå¤©ç•Œé¢æ ·å¼ */
        .ai-chat-history {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            margin-bottom: 20px;
            max-height: 400px;
        }
        
        .ai-chat-history::-webkit-scrollbar {
            width: 6px;
        }
        
        .ai-chat-history::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
        }
        
        .ai-chat-history::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: var(--radius-full);
        }
        
        .ai-chat-history::-webkit-scrollbar-thumb:hover {
            background: var(--text-tertiary);
        }
        
        .ai-message {
            display: flex;
            margin-bottom: 16px;
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .ai-message.user {
            justify-content: flex-end;
        }
        
        .ai-message.assistant {
            justify-content: flex-start;
        }
        
        .ai-message .message-content {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: var(--radius-lg);
            font-size: 14px;
            line-height: 1.5;
            word-wrap: break-word;
        }
        
        .ai-message.user .message-content {
            background: var(--primary);
            color: white;
            border-bottom-right-radius: var(--radius-sm);
        }
        
        .ai-message.assistant .message-content {
            background: white;
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            border-bottom-left-radius: var(--radius-sm);
        }
        
        .ai-message.assistant.loading .message-content {
            color: var(--text-secondary);
            font-style: italic;
        }
        
        .ai-message.assistant.error .message-content {
            background: #fee2e2;
            border-color: #ef4444;
            color: #991b1b;
        }
        
        .typing-indicator {
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        
        .typing-indicator::after {
            content: '...';
            animation: typing 1.5s infinite;
        }
        
        @keyframes typing {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .sidebar {
                width: 200px;
            }
            
            .header {
                padding: 12px 16px;
            }
            
            .search-container {
                width: 240px;
            }
            
            .quick-add-bar {
                padding: 12px 16px;
            }
            
            .tasks-section {
                padding: 16px;
            }
        }
        
        /* è¾…åŠ©æ ·å¼ */
        .text-sm {
            font-size: 12px;
        }
        
        .text-gray-500 {
            color: var(--text-tertiary);
        }
        
        .mb-2 {
            margin-bottom: 8px;
        }
        
        .mb-4 {
            margin-bottom: 16px;
        }
        
        .mb-6 {
            margin-bottom: 24px;
        }
        
        .flex {
            display: flex;
        }
        
        .items-center {
            align-items: center;
        }
        
        .gap-2 {
            gap: 8px;
        }
        
        .gap-4 {
            gap: 16px;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="sidebar-section">
            <div class="sidebar-section-title">è§†å›¾</div>
            <div class="sidebar-item" data-page="ai-assistant">
                <span class="icon icon-ai"></span>
                <span>AIåŠ©æ‰‹</span>
            </div>
            <div class="sidebar-item active" data-page="all-tasks">
                <span class="icon icon-task"></span>
                <span>å…¨éƒ¨ä»»åŠ¡</span>
            </div>
            <div class="sidebar-item" data-page="today">
                <span class="icon icon-today"></span>
                <span>ä»Šå¤©</span>
            </div>
            <div class="sidebar-item" data-page="calendar">
                <span class="icon icon-calendar"></span>
                <span>æ—¥å†è§†å›¾</span>
            </div>
            <div class="sidebar-item" data-page="board">
                <span class="icon icon-board"></span>
                <span>çœ‹æ¿è§†å›¾</span>
            </div>
            <div class="sidebar-item" data-page="quadrant">
                <span class="icon icon-quadrant"></span>
                <span>å››è±¡é™</span>
            </div>
        </div>
        
        <div class="sidebar-section">
            <div class="sidebar-section-title">åŠŸèƒ½</div>
            <div class="sidebar-item" data-page="tomato">
                <span class="icon icon-tomato"></span>
                <span>ç•ªèŒ„ä¸“æ³¨</span>
            </div>
            <div class="sidebar-item" data-page="habit">
                <span class="icon icon-habit"></span>
                <span>ä¹ æƒ¯æ‰“å¡</span>
            </div>
            <div class="sidebar-item" data-page="stats">
                <span class="icon icon-stats"></span>
                <span>æ•°æ®ç»Ÿè®¡</span>
            </div>
        </div>
        
        <div class="sidebar-section">
            <div class="sidebar-section-title">æ¸…å•</div>
            <div class="sidebar-item">
                <span class="icon icon-plus"></span>
                <span>ä¸ªäººé¡¹ç›®</span>
            </div>
            <div class="sidebar-item">
                <span class="icon icon-plus"></span>
                <span>å·¥ä½œä»»åŠ¡</span>
            </div>
        </div>
        
        <div class="sidebar-section">
            <div class="sidebar-section-title">æ ‡ç­¾</div>
            <div class="sidebar-item tag tag-work">
                <span>å·¥ä½œ</span>
            </div>
            <div class="sidebar-item tag tag-life">
                <span>ç”Ÿæ´»</span>
            </div>
            <div class="sidebar-item tag tag-study">
                <span>å­¦ä¹ </span>
            </div>
            <div class="sidebar-item tag tag-health">
                <span>å¥åº·</span>
            </div>
        </div>
    </div>
    
    <div class="main-content">
        <div class="header">
            <div class="header-left">
                <button class="menu-toggle">
                    <span class="icon icon-filter"></span>
                </button>
                <div class="search-container">
                    <span class="icon icon-search"></span>
                    <input type="text" placeholder="æœç´¢ä»»åŠ¡...">
                </div>
            </div>
            <div class="header-right">
                <button class="header-btn">
                    <span class="icon icon-filter"></span>
                </button>
            </div>
        </div>
        
        <!-- å¿«é€Ÿæ·»åŠ ä»»åŠ¡æ  -->
        <div class="quick-add-bar">
            <div class="quick-add-container">
                <input 
                    type="text" 
                    class="quick-add-input" 
                    placeholder="å¿«é€Ÿæ·»åŠ ä»»åŠ¡...(æ”¯æŒæ™ºèƒ½è¯†åˆ«æ—¶é—´)"
                    id="quick-task-input"
                >
                <div class="quick-add-actions">
                    <button class="action-btn">
                        <span class="icon icon-calendar-small"></span>
                    </button>
                    <button class="action-btn">
                        <span class="icon icon-tag"></span>
                    </button>
                    <button class="action-btn">
                        <span class="icon icon-reminder"></span>
                    </button>
                    <button class="add-btn" id="add-task-btn">
                        <span class="icon icon-plus"></span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- ä»»åŠ¡åˆ—è¡¨åŒºåŸŸ -->
        <div class="content" id="content-area">
            <div class="tasks-section" id="tasks-section">
                <div class="no-tasks">
                    <h3>æš‚æ— ä»»åŠ¡</h3>
                    <p>å¼€å§‹æ·»åŠ ä½ çš„ç¬¬ä¸€ä¸ªä»»åŠ¡å§ï¼</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // APIé…ç½®
        const API_BASE_URL = 'http://localhost:3001/api';
        
        // AIæœåŠ¡å‡½æ•°
        async function callDeepSeekAPI(userMessage) {
            try {
                const response = await fetch(`${API_BASE_URL}/messages`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ content: userMessage })
                });

                if (!response.ok) {
                    throw new Error(`APIè°ƒç”¨å¤±è´¥: ${response.status}`);
                }

                const data = await response.json();
                return data.content;
            } catch (error) {
                console.error('DeepSeek APIè°ƒç”¨å¤±è´¥:', error);
                throw error;
            }
        }

        async function parseTaskByAI(userInput) {
            const systemPrompt = `ä½ æ˜¯ä¸€ä¸ªä»»åŠ¡è§£æåŠ©æ‰‹ã€‚è¯·å°†ç”¨æˆ·çš„è‡ªç„¶è¯­è¨€è¾“å…¥è§£æä¸ºç»“æ„åŒ–çš„ä»»åŠ¡æ•°æ®ã€‚
            
è¿”å›æ ¼å¼å¿…é¡»æ˜¯JSONå¯¹è±¡ï¼ŒåŒ…å«ä»¥ä¸‹å­—æ®µï¼š
- title: ä»»åŠ¡æ ‡é¢˜ï¼ˆå­—ç¬¦ä¸²ï¼‰
- description: ä»»åŠ¡æè¿°ï¼ˆå­—ç¬¦ä¸²ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä¸ºç©ºï¼‰
- dueDate: æˆªæ­¢æ—¥æœŸï¼ˆISO 8601æ ¼å¼ï¼Œå¦‚"2024-01-20T15:00:00.000Z"ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä¸ºnullï¼‰
- priority: ä¼˜å…ˆçº§ï¼ˆ"low"ã€"medium"ã€"high"ã€"urgent"ï¼‰
- tags: æ ‡ç­¾æ•°ç»„ï¼ˆå¦‚["å·¥ä½œ", "é‡è¦"]ï¼‰
- isImportant: æ˜¯å¦é‡è¦ï¼ˆå¸ƒå°”å€¼ï¼‰
- isUrgent: æ˜¯å¦ç´§æ€¥ï¼ˆå¸ƒå°”å€¼ï¼‰

ç¤ºä¾‹ï¼š
è¾“å…¥ï¼š"æ˜å¤©ä¸‹åˆ3ç‚¹å®¢æˆ·ä¼šè®®ï¼Œå·¥ä½œæ ‡ç­¾ï¼Œé‡è¦"
è¾“å‡ºï¼š
{
  "title": "å®¢æˆ·ä¼šè®®",
  "description": "æ˜å¤©ä¸‹åˆ3ç‚¹çš„å®¢æˆ·ä¼šè®®",
  "dueDate": "2024-01-20T15:00:00.000Z",
  "priority": "high",
  "tags": ["å·¥ä½œ"],
  "isImportant": true,
  "isUrgent": false
}

åªè¿”å›JSONï¼Œä¸è¦å…¶ä»–æ–‡å­—ã€‚`;

            try {
                const response = await callDeepSeekAPI(`${systemPrompt}\n\nç”¨æˆ·è¾“å…¥ï¼š${userInput}`);
                
                const jsonMatch = response.match(/\{[\s\S]*\}/);
                if (!jsonMatch) {
                    throw new Error('AIè¿”å›çš„ä¸æ˜¯æœ‰æ•ˆçš„JSONæ ¼å¼');
                }
                
                const taskData = JSON.parse(jsonMatch[0]);
                
                return {
                    title: taskData.title || userInput,
                    description: taskData.description || '',
                    dueDate: taskData.dueDate || null,
                    priority: taskData.priority || 'medium',
                    tags: taskData.tags || [],
                    isImportant: taskData.isImportant || false,
                    isUrgent: taskData.isUrgent || false,
                    status: 'todo'
                };
            } catch (error) {
                console.error('AIè§£æä»»åŠ¡å¤±è´¥:', error);
                return null;
            }
        }

        async function classifyTasksByAI(tasks) {
            if (!tasks || tasks.length === 0) {
                return {
                    importantUrgent: [],
                    importantNotUrgent: [],
                    notImportantUrgent: [],
                    notImportantNotUrgent: []
                };
            }

            const systemPrompt = `ä½ æ˜¯ä¸€ä¸ªä»»åŠ¡åˆ†ç±»åŠ©æ‰‹ã€‚è¯·æ ¹æ®ä»»åŠ¡çš„é‡è¦æ€§å’Œç´§æ€¥æ€§å°†ä»»åŠ¡åˆ†ç±»åˆ°å››ä¸ªè±¡é™ã€‚

è¿”å›æ ¼å¼å¿…é¡»æ˜¯JSONå¯¹è±¡ï¼ŒåŒ…å«ä»¥ä¸‹å››ä¸ªæ•°ç»„ï¼š
- importantUrgent: é‡è¦ä¸”ç´§æ€¥çš„ä»»åŠ¡IDæ•°ç»„
- importantNotUrgent: é‡è¦ä½†ä¸ç´§æ€¥çš„ä»»åŠ¡IDæ•°ç»„
- notImportantUrgent: ç´§æ€¥ä½†ä¸é‡è¦çš„ä»»åŠ¡IDæ•°ç»„
- notImportantNotUrgent: ä¸é‡è¦ä¸”ä¸ç´§æ€¥çš„ä»»åŠ¡IDæ•°ç»„

åˆ†ç±»æ ‡å‡†ï¼š
- é‡è¦ç´§æ€¥ï¼šå¯¹ç›®æ ‡å½±å“å¤§ä¸”æ—¶é—´ç´§è¿«
- é‡è¦ä¸ç´§æ€¥ï¼šå¯¹ç›®æ ‡å½±å“å¤§ä½†æ—¶é—´ä¸ç´§è¿«
- ç´§æ€¥ä¸é‡è¦ï¼šæ—¶é—´ç´§è¿«ä½†å¯¹ç›®æ ‡å½±å“å°
- ä¸é‡è¦ä¸ç´§æ€¥ï¼šå¯¹ç›®æ ‡å½±å“å°ä¸”æ—¶é—´ä¸ç´§è¿«

åªè¿”å›JSONï¼Œä¸è¦å…¶ä»–æ–‡å­—ã€‚`;

            try {
                const taskList = JSON.stringify(tasks.map(task => ({
                    id: task._id || task.id,
                    title: task.title,
                    priority: task.priority,
                    dueDate: task.dueDate,
                    tags: task.tags
                })));

                const response = await callDeepSeekAPI(`${systemPrompt}\n\nä»»åŠ¡åˆ—è¡¨ï¼š${taskList}`);
                
                const jsonMatch = response.match(/\{[\s\S]*\}/);
                if (!jsonMatch) {
                    throw new Error('AIè¿”å›çš„ä¸æ˜¯æœ‰æ•ˆçš„JSONæ ¼å¼');
                }
                
                const classification = JSON.parse(jsonMatch[0]);
                
                const taskMap = {};
                tasks.forEach(task => {
                    taskMap[task._id || task.id] = task;
                });
                
                return {
                    importantUrgent: classification.importantUrgent.map(id => taskMap[id]).filter(Boolean),
                    importantNotUrgent: classification.importantNotUrgent.map(id => taskMap[id]).filter(Boolean),
                    notImportantUrgent: classification.notImportantUrgent.map(id => taskMap[id]).filter(Boolean),
                    notImportantNotUrgent: classification.notImportantNotUrgent.map(id => taskMap[id]).filter(Boolean)
                };
            } catch (error) {
                console.error('AIåˆ†ç±»ä»»åŠ¡å¤±è´¥:', error);
                return null;
            }
        }

        async function getPomodoroPromptByAI(taskTitle) {
            const systemPrompt = 'æ ¹æ®ä»»åŠ¡æ ‡é¢˜ç”Ÿæˆå‹å¥½çš„ä¸“æ³¨æç¤ºè¯­ï¼Œç®€çŸ­æœ‰æ¿€åŠ±æ€§ï¼Œä¸è¶…è¿‡50å­—';

            try {
                return await callDeepSeekAPI(`${systemPrompt}\n\nä»»åŠ¡ï¼š${taskTitle}`);
            } catch (error) {
                console.error('AIç”Ÿæˆä¸“æ³¨æç¤ºè¯­å¤±è´¥:', error);
                return 'ä¿æŒä¸“æ³¨ï¼Œä½ å¯ä»¥åšåˆ°çš„ï¼';
            }
        }

        async function getStatsSummaryByAI(statsData) {
            const systemPrompt = 'åˆ†æä»»åŠ¡ç»Ÿè®¡æ•°æ®ï¼Œç”Ÿæˆç®€æ´çš„è‡ªç„¶è¯­è¨€æ€»ç»“ï¼Œä¸è¶…è¿‡100å­—';

            try {
                return await callDeepSeekAPI(`${systemPrompt}\n\næ•°æ®ï¼š${JSON.stringify(statsData)}`);
            } catch (error) {
                console.error('AIç”Ÿæˆç»Ÿè®¡æ€»ç»“å¤±è´¥:', error);
                return 'æ•°æ®ç»Ÿè®¡å®Œæˆï¼Œç»§ç»­ä¿æŒé«˜æ•ˆå·¥ä½œï¼';
            }
        }

        // è¾…åŠ©å‡½æ•°ï¼šæ˜¾ç¤ºæˆåŠŸæç¤º
        function showSuccessToast(message) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #10b981;
                color: white;
                padding: 12px 24px;
                border-radius: 8px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                z-index: 10000;
                animation: slideIn 0.3s ease-out;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // è¾…åŠ©å‡½æ•°ï¼šæ˜¾ç¤ºé”™è¯¯æç¤º
        function showErrorToast(message) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #ef4444;
                color: white;
                padding: 12px 24px;
                border-radius: 8px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                z-index: 10000;
                animation: slideIn 0.3s ease-out;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // æ·»åŠ CSSåŠ¨ç”»
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            @keyframes slideOut {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);
        
        // DOMå…ƒç´ ç¼“å­˜
        const elements = {
            sidebarItems: document.querySelectorAll('.sidebar-item'),
            quickTaskInput: document.getElementById('quick-task-input'),
            addTaskBtn: document.getElementById('add-task-btn'),
            contentArea: document.getElementById('content-area'),
            tasksSection: document.getElementById('tasks-section')
        };
        
        // å¯¼èˆªé¡¹ç‚¹å‡»äº‹ä»¶
        elements.sidebarItems.forEach(item => {
            item.addEventListener('click', function() {
                // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
                elements.sidebarItems.forEach(i => {
                    i.classList.remove('active');
                });
                // æ·»åŠ å½“å‰é¡¹æ´»åŠ¨çŠ¶æ€
                this.classList.add('active');
                
                // å¤„ç†ä¸åŒé¡µé¢åˆ‡æ¢
                const page = this.getAttribute('data-page');
                switch(page) {
                    case 'ai-assistant':
                        loadAIPage();
                        break;
                    case 'all-tasks':
                        loadAllTasks();
                        break;
                    case 'today':
                        loadTodayTasks();
                        break;
                    case 'calendar':
                        loadCalendarView();
                        break;
                    case 'board':
                        loadBoardView();
                        break;
                    case 'quadrant':
                        loadQuadrantView();
                        break;
                    case 'tomato':
                        loadTomatoTimer();
                        break;
                    case 'habit':
                        loadHabitTracker();
                        break;
                    case 'stats':
                        loadStatistics();
                        break;
                }
            });
        });
        
        // æ·»åŠ ä»»åŠ¡äº‹ä»¶
        elements.addTaskBtn.addEventListener('click', addTask);
        
        // å¿«é€Ÿæ·»åŠ ä»»åŠ¡è¾“å…¥æ¡†å›è½¦äº‹ä»¶
        elements.quickTaskInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addTask();
            }
        });
        
        // æ·»åŠ ä»»åŠ¡å‡½æ•°
        async function addTask() {
            const taskText = elements.quickTaskInput.value.trim();
            if (!taskText) return;
            
            try {
                // 1. è°ƒç”¨DeepSeek AIè§£æç”¨æˆ·è¾“å…¥
                const taskData = await parseTaskByAI(taskText);
                
                if (taskData) {
                    // 2. ä½¿ç”¨AIè§£æçš„æ•°æ®è°ƒç”¨APIåˆ›å»ºä»»åŠ¡
                    const response = await fetch(`${API_BASE_URL}/tasks`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(taskData)
                    });
                    
                    if (response.ok) {
                        elements.quickTaskInput.value = '';
                        showSuccessToast(`å·²åˆ›å»ºä»»åŠ¡ï¼š${taskData.title}`);
                        loadAllTasks(); // é‡æ–°åŠ è½½ä»»åŠ¡åˆ—è¡¨
                    } else {
                        console.error('æ·»åŠ ä»»åŠ¡å¤±è´¥:', await response.text());
                        showErrorToast('æ·»åŠ ä»»åŠ¡å¤±è´¥');
                    }
                } else {
                    // AIè§£æå¤±è´¥ï¼Œä½¿ç”¨åŸå§‹æ–‡æœ¬åˆ›å»ºä»»åŠ¡
                    const response = await fetch(`${API_BASE_URL}/tasks`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            title: taskText,
                            description: '',
                            status: 'todo',
                            priority: 'medium',
                            tags: [],
                            isImportant: false,
                            isUrgent: false
                        })
                    });
                    
                    if (response.ok) {
                        elements.quickTaskInput.value = '';
                        showSuccessToast(`å·²åˆ›å»ºä»»åŠ¡ï¼š${taskText}`);
                        loadAllTasks();
                    } else {
                        console.error('æ·»åŠ ä»»åŠ¡å¤±è´¥:', await response.text());
                        showErrorToast('æ·»åŠ ä»»åŠ¡å¤±è´¥');
                    }
                }
            } catch (error) {
                console.error('æ·»åŠ ä»»åŠ¡å¤±è´¥:', error);
                // å¦‚æœAPIè°ƒç”¨å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°æ¨¡æ‹Ÿæ•°æ®
                console.log('ä½¿ç”¨æœ¬åœ°æ¨¡æ‹Ÿæ•°æ®æ·»åŠ ä»»åŠ¡');
                elements.quickTaskInput.value = '';
                loadAllTasks();
            }
        }
        
        // åŠ è½½AIåŠ©æ‰‹é¡µé¢
        function loadAIPage() {
            elements.contentArea.innerHTML = `
                <div class="ai-assistant-page">
                    <div class="ai-header">
                        <span class="icon icon-ai"></span>
                        <h2>AIåŠ©æ‰‹</h2>
                    </div>
                    
                    <div class="ai-welcome mb-6">
                        <h3>ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„AIä»»åŠ¡åŠ©æ‰‹</h3>
                        <ul>
                            <li>æ™ºèƒ½åˆ›å»ºä»»åŠ¡ï¼ˆä¾‹å¦‚ï¼š"æ˜å¤©ä¸‹åˆ3ç‚¹å¼€ä¼š"ï¼‰</li>
                            <li>åˆ†æä»»åŠ¡ä¼˜å…ˆçº§</li>
                            <li>æä¾›æ—¶é—´ç®¡ç†å»ºè®®</li>
                            <li>ä¼˜åŒ–ä»»åŠ¡å®‰æ’</li>
                        </ul>
                    </div>
                    
                    <div class="ai-chat-history" id="ai-chat-history">
                        <div class="ai-message assistant">
                            <div class="message-content">
                                ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„AIä»»åŠ¡åŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ
                            </div>
                        </div>
                    </div>
                    
                    <div class="ai-input-section">
                        <div class="ai-input-container">
                            <textarea 
                                class="ai-input" 
                                placeholder="è¾“å…¥ä½ çš„é—®é¢˜æˆ–æŒ‡ä»¤..."
                                rows="3"
                                id="ai-input"
                            ></textarea>
                            <div class="ai-input-footer">
                                <div class="ai-example">
                                    è¯•è¯•ï¼š"åˆ›å»ºæ˜å¤©ä¸‹åˆ3ç‚¹çš„é‡è¦ä¼šè®®ä»»åŠ¡"
                                </div>
                                <button class="ai-send-btn" id="ai-send-btn">
                                    <span>å‘é€</span>
                                    <span class="icon icon-plus"></span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // ç»‘å®šAIå‘é€æŒ‰é’®äº‹ä»¶
            document.getElementById('ai-send-btn').addEventListener('click', sendAIMessage);
            document.getElementById('ai-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendAIMessage();
                }
            });
        }
        
        // å‘é€AIæ¶ˆæ¯
        async function sendAIMessage() {
            const aiInput = document.getElementById('ai-input');
            const chatHistory = document.getElementById('ai-chat-history');
            const message = aiInput.value.trim();
            if (!message) return;
            
            // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯åˆ°èŠå¤©å†å²
            const userMessageDiv = document.createElement('div');
            userMessageDiv.className = 'ai-message user';
            userMessageDiv.innerHTML = `
                <div class="message-content">
                    ${message}
                </div>
            `;
            chatHistory.appendChild(userMessageDiv);
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            aiInput.value = '';
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'ai-message assistant loading';
            loadingDiv.innerHTML = `
                <div class="message-content">
                    <span class="typing-indicator">AIæ­£åœ¨æ€è€ƒ...</span>
                </div>
            `;
            chatHistory.appendChild(loadingDiv);
            chatHistory.scrollTop = chatHistory.scrollHeight;
            
            try {
                // è°ƒç”¨AIè·å–å›å¤
                const systemPrompt = 'ä½ æ˜¯ä¸€ä¸ªAIä»»åŠ¡ç®¡ç†åŠ©æ‰‹ï¼Œèƒ½å¤Ÿç†è§£è‡ªç„¶è¯­è¨€å¹¶å¸®åŠ©ç”¨æˆ·åˆ›å»ºã€ç®¡ç†å’Œåˆ†æä»»åŠ¡ã€‚ä½ å¯ä»¥ï¼š1. æ™ºèƒ½åˆ›å»ºä»»åŠ¡ï¼ˆä¾‹å¦‚ï¼š"æ˜å¤©ä¸‹åˆ3ç‚¹å¼€ä¼š"ï¼‰ï¼›2. åˆ†æä»»åŠ¡ä¼˜å…ˆçº§ï¼›3. æä¾›æ—¶é—´ç®¡ç†å»ºè®®ï¼›4. ä¼˜åŒ–ä»»åŠ¡å®‰æ’ã€‚è¯·ä½¿ç”¨å‹å¥½ã€ä¸“ä¸šçš„è¯­è¨€å›ç­”ç”¨æˆ·çš„é—®é¢˜ã€‚';
                const response = await callDeepSeekAPI(`${systemPrompt}\n\nç”¨æˆ·ï¼š${message}`);
                
                // ç§»é™¤åŠ è½½çŠ¶æ€
                loadingDiv.remove();
                
                // æ·»åŠ AIå›å¤åˆ°èŠå¤©å†å²
                const assistantMessageDiv = document.createElement('div');
                assistantMessageDiv.className = 'ai-message assistant';
                assistantMessageDiv.innerHTML = `
                    <div class="message-content">
                        ${response}
                    </div>
                `;
                chatHistory.appendChild(assistantMessageDiv);
                chatHistory.scrollTop = chatHistory.scrollHeight;
                
                // æ£€æŸ¥æ˜¯å¦éœ€è¦åˆ›å»ºä»»åŠ¡
                if (message.includes('åˆ›å»º') || message.includes('æ·»åŠ ') || message.includes('æ–°å»º')) {
                    try {
                        const taskData = await parseTaskByAI(message);
                        if (taskData) {
                            const taskResponse = await fetch(`${API_BASE_URL}/tasks`, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify(taskData)
                            });
                            
                            if (taskResponse.ok) {
                                showSuccessToast(`å·²åˆ›å»ºä»»åŠ¡ï¼š${taskData.title}`);
                            }
                        }
                    } catch (error) {
                        console.error('è‡ªåŠ¨åˆ›å»ºä»»åŠ¡å¤±è´¥:', error);
                    }
                }
            } catch (error) {
                console.error('AIå›å¤å¤±è´¥:', error);
                loadingDiv.remove();
                
                // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
                const errorMessageDiv = document.createElement('div');
                errorMessageDiv.className = 'ai-message assistant error';
                errorMessageDiv.innerHTML = `
                    <div class="message-content">
                        æŠ±æ­‰ï¼ŒAIæœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åå†è¯•ã€‚
                    </div>
                `;
                chatHistory.appendChild(errorMessageDiv);
                chatHistory.scrollTop = chatHistory.scrollHeight;
            }
        }
        
        // åŠ è½½å…¨éƒ¨ä»»åŠ¡
        async function loadAllTasks() {
            try {
                const response = await fetch(`${API_BASE_URL}/tasks`);
                let tasks = await response.json();
                
                // å¦‚æœAPIè°ƒç”¨å¤±è´¥æˆ–è¿”å›ç©ºæ•°ç»„ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
                if (!Array.isArray(tasks) || tasks.length === 0) {
                    tasks = [];
                }
                
                displayTasks(tasks);
            } catch (error) {
                console.error('åŠ è½½ä»»åŠ¡å¤±è´¥:', error);
                // ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
                displayTasks([]);
            }
        }
        
        // æ˜¾ç¤ºä»»åŠ¡åˆ—è¡¨
        function displayTasks(tasks) {
            if (tasks.length === 0) {
                elements.tasksSection.innerHTML = `
                    <div class="no-tasks">
                        <h3>æš‚æ— ä»»åŠ¡</h3>
                        <p>å¼€å§‹æ·»åŠ ä½ çš„ç¬¬ä¸€ä¸ªä»»åŠ¡å§ï¼</p>
                    </div>
                `;
                return;
            }
            
            elements.tasksSection.innerHTML = `
                <div class="tasks-list">
                    ${tasks.map(task => `
                        <div class="task-card">
                            <div class="task-checkbox" onclick="toggleTaskStatus('${task._id}', ${task.status === 'completed'})">
                                ${task.status === 'completed' ? 'âœ“' : ''}
                            </div>
                            <div class="task-info">
                                <div class="task-title ${task.status === 'completed' ? 'completed' : ''}">
                                    ${task.title}
                                </div>
                                <div class="task-meta">
                                    ${task.dueDate ? `<span><span class="icon icon-calendar-small"></span>${new Date(task.dueDate).toLocaleString()}</span>` : ''}
                                    ${task.tags.length > 0 ? task.tags.map(tag => `<span class="tag tag-${tag.toLowerCase()}">${tag}</span>`).join('') : ''}
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        // åˆ‡æ¢ä»»åŠ¡çŠ¶æ€
        async function toggleTaskStatus(taskId, isCompleted) {
            try {
                const response = await fetch(`${API_BASE_URL}/tasks/${taskId}/complete`, {
                    method: 'PATCH'
                });
                
                if (response.ok) {
                    loadAllTasks(); // é‡æ–°åŠ è½½ä»»åŠ¡åˆ—è¡¨
                } else {
                    console.error('æ›´æ–°ä»»åŠ¡çŠ¶æ€å¤±è´¥:', await response.text());
                }
            } catch (error) {
                console.error('æ›´æ–°ä»»åŠ¡çŠ¶æ€å¤±è´¥:', error);
                // æœ¬åœ°æ›´æ–°UI
                loadAllTasks();
            }
        }
        
        // åŠ è½½ä»Šå¤©çš„ä»»åŠ¡
        function loadTodayTasks() {
            elements.contentArea.innerHTML = `
                <div class="tasks-section">
                    <h2 style="font-size: 18px; font-weight: 600; margin-bottom: 24px;">ä»Šå¤©çš„ä»»åŠ¡</h2>
                    <div class="no-tasks">
                        <h3>æš‚æ— ä»»åŠ¡</h3>
                        <p>ä»Šå¤©æ²¡æœ‰å®‰æ’ä»»åŠ¡</p>
                    </div>
                </div>
            `;
        }
        
        // åŠ è½½æ—¥å†è§†å›¾
        function loadCalendarView() {
            elements.contentArea.innerHTML = `
                <div class="tasks-section">
                    <h2 style="font-size: 18px; font-weight: 600; margin-bottom: 24px;">æ—¥å†è§†å›¾</h2>
                    <div class="no-tasks">
                        <h3>æ—¥å†è§†å›¾</h3>
                        <p>åŠŸèƒ½å¼€å‘ä¸­...</p>
                    </div>
                </div>
            `;
        }
        
        // åŠ è½½çœ‹æ¿è§†å›¾
        function loadBoardView() {
            elements.contentArea.innerHTML = `
                <div class="tasks-section">
                    <h2 style="font-size: 18px; font-weight: 600; margin-bottom: 24px;">çœ‹æ¿è§†å›¾</h2>
                    <div class="no-tasks">
                        <h3>çœ‹æ¿è§†å›¾</h3>
                        <p>åŠŸèƒ½å¼€å‘ä¸­...</p>
                    </div>
                </div>
            `;
        }
        
        // åŠ è½½å››è±¡é™è§†å›¾
        async function loadQuadrantView() {
            try {
                // 1. è·å–æ‰€æœ‰ä»»åŠ¡
                const tasksResponse = await fetch(`${API_BASE_URL}/tasks`);
                const allTasks = await tasksResponse.json();
                
                if (!Array.isArray(allTasks) || allTasks.length === 0) {
                    elements.contentArea.innerHTML = `
                        <div class="tasks-section">
                            <h2 style="font-size: 18px; font-weight: 600; margin-bottom: 24px;">å››è±¡é™è§†å›¾</h2>
                            <div class="no-tasks">
                                <h3>æš‚æ— ä»»åŠ¡</h3>
                                <p>åˆ›å»ºä¸€äº›ä»»åŠ¡åï¼ŒAIä¼šè‡ªåŠ¨å¸®ä½ åˆ†ç±»åˆ°å››ä¸ªè±¡é™</p>
                            </div>
                        </div>
                    `;
                    return;
                }
                
                // 2. è°ƒç”¨AIè¿›è¡Œå››è±¡é™åˆ†ç±»
                let quadrantData;
                try {
                    quadrantData = await classifyTasksByAI(allTasks);
                } catch (error) {
                    console.error('AIåˆ†ç±»å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤åˆ†ç±»:', error);
                    // AIåˆ†ç±»å¤±è´¥æ—¶ä½¿ç”¨é»˜è®¤è§„åˆ™
                    quadrantData = {
                        importantUrgent: allTasks.filter(task => task.isImportant && task.isUrgent),
                        importantNotUrgent: allTasks.filter(task => task.isImportant && !task.isUrgent),
                        notImportantUrgent: allTasks.filter(task => !task.isImportant && task.isUrgent),
                        notImportantNotUrgent: allTasks.filter(task => !task.isImportant && !task.isUrgent)
                    };
                }
                
                // 3. æ¸²æŸ“å››è±¡é™è§†å›¾
                elements.contentArea.innerHTML = `
                    <div class="tasks-section">
                        <h2 style="font-size: 18px; font-weight: 600; margin-bottom: 24px;">å››è±¡é™è§†å›¾</h2>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; height: calc(100vh - 200px);">
                            <!-- ç¬¬ä¸€è±¡é™ï¼šé‡è¦ç´§æ€¥ -->
                            <div style="background: #fee2e2; border: 2px solid #ef4444; border-radius: 12px; padding: 20px;">
                                <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px; color: #991b1b;">ğŸ”´ é‡è¦ç´§æ€¥</h3>
                                ${quadrantData.importantUrgent.length > 0 ? quadrantData.importantUrgent.map(task => `
                                    <div style="background: white; padding: 12px; border-radius: 8px; margin-bottom: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                                        <p style="font-weight: 500; margin-bottom: 4px;">${task.title}</p>
                                        <p style="font-size: 12px; color: #64748b;">${task.dueDate ? new Date(task.dueDate).toLocaleString() : 'æ— æˆªæ­¢æ—¥æœŸ'}</p>
                                    </div>
                                `).join('') : '<p style="color: #64748b; font-style: italic;">æš‚æ— ä»»åŠ¡</p>'}
                            </div>
                            
                            <!-- ç¬¬äºŒè±¡é™ï¼šé‡è¦ä¸ç´§æ€¥ -->
                            <div style="background: #dbeafe; border: 2px solid #3b82f6; border-radius: 12px; padding: 20px;">
                                <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px; color: #1e40af;">ğŸ”µ é‡è¦ä¸ç´§æ€¥</h3>
                                ${quadrantData.importantNotUrgent.length > 0 ? quadrantData.importantNotUrgent.map(task => `
                                    <div style="background: white; padding: 12px; border-radius: 8px; margin-bottom: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                                        <p style="font-weight: 500; margin-bottom: 4px;">${task.title}</p>
                                        <p style="font-size: 12px; color: #64748b;">${task.dueDate ? new Date(task.dueDate).toLocaleString() : 'æ— æˆªæ­¢æ—¥æœŸ'}</p>
                                    </div>
                                `).join('') : '<p style="color: #64748b; font-style: italic;">æš‚æ— ä»»åŠ¡</p>'}
                            </div>
                            
                            <!-- ç¬¬ä¸‰è±¡é™ï¼šç´§æ€¥ä¸é‡è¦ -->
                            <div style="background: #fef3c7; border: 2px solid #f59e0b; border-radius: 12px; padding: 20px;">
                                <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px; color: #92400e;">ğŸŸ¡ ç´§æ€¥ä¸é‡è¦</h3>
                                ${quadrantData.notImportantUrgent.length > 0 ? quadrantData.notImportantUrgent.map(task => `
                                    <div style="background: white; padding: 12px; border-radius: 8px; margin-bottom: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                                        <p style="font-weight: 500; margin-bottom: 4px;">${task.title}</p>
                                        <p style="font-size: 12px; color: #64748b;">${task.dueDate ? new Date(task.dueDate).toLocaleString() : 'æ— æˆªæ­¢æ—¥æœŸ'}</p>
                                    </div>
                                `).join('') : '<p style="color: #64748b; font-style: italic;">æš‚æ— ä»»åŠ¡</p>'}
                            </div>
                            
                            <!-- ç¬¬å››è±¡é™ï¼šä¸ç´§æ€¥ä¸é‡è¦ -->
                            <div style="background: #d1fae5; border: 2px solid #10b981; border-radius: 12px; padding: 20px;">
                                <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px; color: #065f46;">ğŸŸ¢ ä¸ç´§æ€¥ä¸é‡è¦</h3>
                                ${quadrantData.notImportantNotUrgent.length > 0 ? quadrantData.notImportantNotUrgent.map(task => `
                                    <div style="background: white; padding: 12px; border-radius: 8px; margin-bottom: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                                        <p style="font-weight: 500; margin-bottom: 4px;">${task.title}</p>
                                        <p style="font-size: 12px; color: #64748b;">${task.dueDate ? new Date(task.dueDate).toLocaleString() : 'æ— æˆªæ­¢æ—¥æœŸ'}</p>
                                    </div>
                                `).join('') : '<p style="color: #64748b; font-style: italic;">æš‚æ— ä»»åŠ¡</p>'}
                            </div>
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('åŠ è½½å››è±¡é™è§†å›¾å¤±è´¥:', error);
                elements.contentArea.innerHTML = `
                    <div class="tasks-section">
                        <h2 style="font-size: 18px; font-weight: 600; margin-bottom: 24px;">å››è±¡é™è§†å›¾</h2>
                        <div class="no-tasks">
                            <h3>åŠ è½½å¤±è´¥</h3>
                            <p>è¯·ç¨åé‡è¯•</p>
                        </div>
                    </div>
                `;
            }
        }
        
        // åŠ è½½ç•ªèŒ„ä¸“æ³¨
        async function loadTomatoTimer() {
            try {
                // è·å–ä»»åŠ¡åˆ—è¡¨
                const tasksResponse = await fetch(`${API_BASE_URL}/tasks`);
                const allTasks = await tasksResponse.json();
                const todoTasks = Array.isArray(allTasks) ? allTasks.filter(task => task.status === 'todo') : [];
                
                // è·å–AIæç¤ºè¯­
                let aiPrompt = 'ä¿æŒä¸“æ³¨ï¼Œä½ å¯ä»¥åšåˆ°çš„ï¼';
                if (todoTasks.length > 0) {
                    try {
                        aiPrompt = await getPomodoroPromptByAI(todoTasks[0].title);
                    } catch (error) {
                        console.error('è·å–AIæç¤ºè¯­å¤±è´¥:', error);
                    }
                }
                
                elements.contentArea.innerHTML = `
                    <div class="tasks-section">
                        <h2 style="font-size: 18px; font-weight: 600; margin-bottom: 24px;">ç•ªèŒ„ä¸“æ³¨</h2>
                        
                        <div style="max-width: 600px; margin: 0 auto; text-align: center;">
                            <!-- AIæç¤ºè¯­ -->
                            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 24px; border-radius: 16px; margin-bottom: 32px; box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);">
                                <p style="font-size: 18px; font-weight: 500; margin: 0;">${aiPrompt}</p>
                            </div>
                            
                            <!-- è®¡æ—¶å™¨ -->
                            <div style="margin-bottom: 32px;">
                                <div id="timer-display" style="font-size: 80px; font-weight: 700; color: var(--primary); font-family: 'Courier New', monospace; line-height: 1;">
                                    25:00
                                </div>
                            </div>
                            
                            <!-- ä»»åŠ¡é€‰æ‹© -->
                            <div style="margin-bottom: 32px;">
                                <label style="display: block; font-size: 14px; color: var(--text-secondary); margin-bottom: 8px;">é€‰æ‹©è¦ä¸“æ³¨çš„ä»»åŠ¡ï¼š</label>
                                <select id="tomato-task-select" style="width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: var(--radius-md); font-size: 14px; background: white;">
                                    ${todoTasks.length > 0 ? todoTasks.map(task => `
                                        <option value="${task._id}">${task.title}</option>
                                    `).join('') : '<option value="">æš‚æ— å¾…åŠä»»åŠ¡</option>'}
                                </select>
                            </div>
                            
                            <!-- æ§åˆ¶æŒ‰é’® -->
                            <div style="display: flex; gap: 12px; justify-content: center; margin-bottom: 24px;">
                                <button id="start-timer-btn" style="padding: 14px 32px; background: var(--primary); color: white; border: none; border-radius: var(--radius-full); font-size: 16px; font-weight: 600; cursor: pointer; transition: var(--transition);">
                                    å¼€å§‹ä¸“æ³¨
                                </button>
                                <button id="pause-timer-btn" style="padding: 14px 32px; background: var(--warning); color: white; border: none; border-radius: var(--radius-full); font-size: 16px; font-weight: 600; cursor: pointer; transition: var(--transition); display: none;">
                                    æš‚åœ
                                </button>
                                <button id="reset-timer-btn" style="padding: 14px 32px; background: var(--bg-tertiary); color: var(--text-primary); border: 2px solid var(--border-color); border-radius: var(--radius-full); font-size: 16px; font-weight: 600; cursor: pointer; transition: var(--transition);">
                                    é‡ç½®
                                </button>
                            </div>
                            
                            <!-- ç»Ÿè®¡ä¿¡æ¯ -->
                            <div style="display: flex; justify-content: center; gap: 32px; color: var(--text-secondary); font-size: 14px;">
                                <div>
                                    <span style="font-weight: 600;">ä»Šæ—¥ä¸“æ³¨ï¼š</span>
                                    <span id="today-pomodoros">0</span> ä¸ªç•ªèŒ„
                                </div>
                                <div>
                                    <span style="font-weight: 600;">æ€»ä¸“æ³¨æ—¶é•¿ï¼š</span>
                                    <span id="total-focus-time">0</span> åˆ†é’Ÿ
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // ç»‘å®šæŒ‰é’®äº‹ä»¶
                let timerInterval = null;
                let timeLeft = 25 * 60; // 25åˆ†é’Ÿ
                let isRunning = false;
                
                const timerDisplay = document.getElementById('timer-display');
                const startBtn = document.getElementById('start-timer-btn');
                const pauseBtn = document.getElementById('pause-timer-btn');
                const resetBtn = document.getElementById('reset-timer-btn');
                const taskSelect = document.getElementById('tomato-task-select');
                
                function updateDisplay() {
                    const minutes = Math.floor(timeLeft / 60);
                    const seconds = timeLeft % 60;
                    timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }
                
                startBtn.addEventListener('click', () => {
                    if (!isRunning) {
                        isRunning = true;
                        startBtn.style.display = 'none';
                        pauseBtn.style.display = 'inline-block';
                        
                        timerInterval = setInterval(() => {
                            timeLeft--;
                            updateDisplay();
                            
                            if (timeLeft <= 0) {
                                clearInterval(timerInterval);
                                isRunning = false;
                                startBtn.style.display = 'inline-block';
                                pauseBtn.style.display = 'none';
                                showSuccessToast('ğŸ‰ æ­å–œï¼å®Œæˆäº†ä¸€ä¸ªç•ªèŒ„é’Ÿï¼');
                                
                                // æ›´æ–°ç»Ÿè®¡
                                const todayPomodoros = parseInt(document.getElementById('today-pomodoros').textContent) + 1;
                                const totalFocusTime = parseInt(document.getElementById('total-focus-time').textContent) + 25;
                                document.getElementById('today-pomodoros').textContent = todayPomodoros;
                                document.getElementById('total-focus-time').textContent = totalFocusTime;
                            }
                        }, 1000);
                    }
                });
                
                pauseBtn.addEventListener('click', () => {
                    if (isRunning) {
                        isRunning = false;
                        clearInterval(timerInterval);
                        startBtn.style.display = 'inline-block';
                        pauseBtn.style.display = 'none';
                        startBtn.textContent = 'ç»§ç»­ä¸“æ³¨';
                    }
                });
                
                resetBtn.addEventListener('click', () => {
                    isRunning = false;
                    clearInterval(timerInterval);
                    timeLeft = 25 * 60;
                    updateDisplay();
                    startBtn.style.display = 'inline-block';
                    pauseBtn.style.display = 'none';
                    startBtn.textContent = 'å¼€å§‹ä¸“æ³¨';
                });
                
                // ä»»åŠ¡é€‰æ‹©å˜åŒ–æ—¶æ›´æ–°AIæç¤ºè¯­
                taskSelect.addEventListener('change', async (e) => {
                    const selectedTaskId = e.target.value;
                    const selectedTask = todoTasks.find(task => task._id === selectedTaskId);
                    if (selectedTask) {
                        try {
                            const newPrompt = await getPomodoroPromptByAI(selectedTask.title);
                            const promptElement = elements.contentArea.querySelector('.tasks-section > div > div:first-child p');
                            if (promptElement) {
                                promptElement.textContent = newPrompt;
                            }
                        } catch (error) {
                            console.error('è·å–AIæç¤ºè¯­å¤±è´¥:', error);
                        }
                    }
                });
                
            } catch (error) {
                console.error('åŠ è½½ç•ªèŒ„ä¸“æ³¨å¤±è´¥:', error);
                elements.contentArea.innerHTML = `
                    <div class="tasks-section">
                        <h2 style="font-size: 18px; font-weight: 600; margin-bottom: 24px;">ç•ªèŒ„ä¸“æ³¨</h2>
                        <div class="no-tasks">
                            <h3>åŠ è½½å¤±è´¥</h3>
                            <p>è¯·ç¨åé‡è¯•</p>
                        </div>
                    </div>
                `;
            }
        }
        
        // åŠ è½½ä¹ æƒ¯æ‰“å¡
        function loadHabitTracker() {
            elements.contentArea.innerHTML = `
                <div class="tasks-section">
                    <h2 style="font-size: 18px; font-weight: 600; margin-bottom: 24px;">ä¹ æƒ¯æ‰“å¡</h2>
                    <div class="no-tasks">
                        <h3>ä¹ æƒ¯æ‰“å¡</h3>
                        <p>åŠŸèƒ½å¼€å‘ä¸­...</p>
                    </div>
                </div>
            `;
        }
        
        // åŠ è½½æ•°æ®ç»Ÿè®¡
        async function loadStatistics() {
            try {
                // è·å–æ‰€æœ‰ä»»åŠ¡
                const tasksResponse = await fetch(`${API_BASE_URL}/tasks`);
                const allTasks = await tasksResponse.json();
                
                if (!Array.isArray(allTasks)) {
                    allTasks = [];
                }
                
                // è®¡ç®—ç»Ÿè®¡æ•°æ®
                const stats = {
                    totalTasks: allTasks.length,
                    completedTasks: allTasks.filter(task => task.status === 'completed').length,
                    todoTasks: allTasks.filter(task => task.status === 'todo').length,
                    inProgressTasks: allTasks.filter(task => task.status === 'in-progress').length,
                    importantTasks: allTasks.filter(task => task.isImportant).length,
                    urgentTasks: allTasks.filter(task => task.isUrgent).length,
                    highPriorityTasks: allTasks.filter(task => task.priority === 'high' || task.priority === 'urgent').length,
                    tasksByTag: {},
                    completionRate: 0
                };
                
                // æŒ‰æ ‡ç­¾ç»Ÿè®¡
                allTasks.forEach(task => {
                    task.tags.forEach(tag => {
                        stats.tasksByTag[tag] = (stats.tasksByTag[tag] || 0) + 1;
                    });
                });
                
                // è®¡ç®—å®Œæˆç‡
                if (stats.totalTasks > 0) {
                    stats.completionRate = Math.round((stats.completedTasks / stats.totalTasks) * 100);
                }
                
                // è·å–AIæ€»ç»“
                let aiSummary = 'æš‚æ— æ•°æ®';
                try {
                    aiSummary = await getStatsSummaryByAI(stats);
                } catch (error) {
                    console.error('è·å–AIæ€»ç»“å¤±è´¥:', error);
                    aiSummary = 'æ•°æ®ç»Ÿè®¡å®Œæˆï¼Œç»§ç»­ä¿æŒé«˜æ•ˆå·¥ä½œï¼';
                }
                
                // æ¸²æŸ“ç»Ÿè®¡é¡µé¢
                elements.contentArea.innerHTML = `
                    <div class="tasks-section">
                        <h2 style="font-size: 18px; font-weight: 600; margin-bottom: 24px;">æ•°æ®ç»Ÿè®¡</h2>
                        
                        <!-- AIæ€»ç»“ -->
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 24px; border-radius: 16px; margin-bottom: 32px; box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                                <span style="font-size: 24px;">ğŸ¤–</span>
                                <h3 style="margin: 0; font-size: 16px; font-weight: 600;">AIæ™ºèƒ½åˆ†æ</h3>
                            </div>
                            <p style="font-size: 15px; line-height: 1.6; margin: 0;">${aiSummary}</p>
                        </div>
                        
                        <!-- ç»Ÿè®¡å¡ç‰‡ -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 32px;">
                            <div style="background: white; padding: 20px; border-radius: 12px; border: 1px solid var(--border-color); box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                                <div style="color: var(--text-secondary); font-size: 14px; margin-bottom: 8px;">æ€»ä»»åŠ¡æ•°</div>
                                <div style="font-size: 32px; font-weight: 700; color: var(--primary);">${stats.totalTasks}</div>
                            </div>
                            
                            <div style="background: white; padding: 20px; border-radius: 12px; border: 1px solid var(--border-color); box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                                <div style="color: var(--text-secondary); font-size: 14px; margin-bottom: 8px;">å·²å®Œæˆ</div>
                                <div style="font-size: 32px; font-weight: 700; color: var(--success);">${stats.completedTasks}</div>
                            </div>
                            
                            <div style="background: white; padding: 20px; border-radius: 12px; border: 1px solid var(--border-color); box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                                <div style="color: var(--text-secondary); font-size: 14px; margin-bottom: 8px;">å¾…åŠä¸­</div>
                                <div style="font-size: 32px; font-weight: 700; color: var(--warning);">${stats.todoTasks}</div>
                            </div>
                            
                            <div style="background: white; padding: 20px; border-radius: 12px; border: 1px solid var(--border-color); box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                                <div style="color: var(--text-secondary); font-size: 14px; margin-bottom: 8px;">è¿›è¡Œä¸­</div>
                                <div style="font-size: 32px; font-weight: 700; color: var(--info);">${stats.inProgressTasks}</div>
                            </div>
                        </div>
                        
                        <!-- å®Œæˆç‡ -->
                        <div style="background: white; padding: 24px; border-radius: 12px; border: 1px solid var(--border-color); box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 32px;">
                            <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px;">ä»»åŠ¡å®Œæˆç‡</h3>
                            <div style="display: flex; align-items: center; gap: 20px;">
                                <div style="flex: 1;">
                                    <div style="height: 20px; background: var(--bg-tertiary); border-radius: 10px; overflow: hidden; margin-bottom: 8px;">
                                        <div style="height: 100%; background: linear-gradient(90deg, var(--success) 0%, #34d399 100%); transition: width 0.5s ease; width: ${stats.completionRate}%;"></div>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; font-size: 14px; color: var(--text-secondary);">
                                        <span>å·²å®Œæˆ ${stats.completedTasks} ä¸ª</span>
                                        <span>${stats.completionRate}%</span>
                                    </div>
                                </div>
                                <div style="font-size: 48px; font-weight: 700; color: var(--success);">${stats.completionRate}%</div>
                            </div>
                        </div>
                        
                        <!-- ä¼˜å…ˆçº§åˆ†å¸ƒ -->
                        <div style="background: white; padding: 24px; border-radius: 12px; border: 1px solid var(--border-color); box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 32px;">
                            <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px;">ä¼˜å…ˆçº§åˆ†å¸ƒ</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px;">
                                <div style="text-align: center; padding: 16px; background: #fee2e2; border-radius: 8px;">
                                    <div style="font-size: 24px; font-weight: 700; color: #ef4444; margin-bottom: 4px;">${allTasks.filter(task => task.priority === 'urgent').length}</div>
                                    <div style="font-size: 12px; color: #991b1b;">ç´§æ€¥</div>
                                </div>
                                <div style="text-align: center; padding: 16px; background: #fef3c7; border-radius: 8px;">
                                    <div style="font-size: 24px; font-weight: 700; color: #f59e0b; margin-bottom: 4px;">${allTasks.filter(task => task.priority === 'high').length}</div>
                                    <div style="font-size: 12px; color: #92400e;">é«˜</div>
                                </div>
                                <div style="text-align: center; padding: 16px; background: #dbeafe; border-radius: 8px;">
                                    <div style="font-size: 24px; font-weight: 700; color: #3b82f6; margin-bottom: 4px;">${allTasks.filter(task => task.priority === 'medium').length}</div>
                                    <div style="font-size: 12px; color: #1e40af;">ä¸­</div>
                                </div>
                                <div style="text-align: center; padding: 16px; background: #d1fae5; border-radius: 8px;">
                                    <div style="font-size: 24px; font-weight: 700; color: #10b981; margin-bottom: 4px;">${allTasks.filter(task => task.priority === 'low').length}</div>
                                    <div style="font-size: 12px; color: #065f46;">ä½</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- æ ‡ç­¾ç»Ÿè®¡ -->
                        ${Object.keys(stats.tasksByTag).length > 0 ? `
                        <div style="background: white; padding: 24px; border-radius: 12px; border: 1px solid var(--border-color); box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                            <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px;">æ ‡ç­¾ç»Ÿè®¡</h3>
                            <div style="display: flex; flex-wrap: wrap; gap: 12px;">
                                ${Object.entries(stats.tasksByTag).map(([tag, count]) => `
                                    <div style="display: flex; align-items: center; gap: 8px; padding: 8px 16px; background: var(--bg-tertiary); border-radius: 20px;">
                                        <span style="font-weight: 500;">${tag}</span>
                                        <span style="background: var(--primary); color: white; padding: 2px 8px; border-radius: 10px; font-size: 12px;">${count}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        ` : ''}
                    </div>
                `;
            } catch (error) {
                console.error('åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥:', error);
                elements.contentArea.innerHTML = `
                    <div class="tasks-section">
                        <h2 style="font-size: 18px; font-weight: 600; margin-bottom: 24px;">æ•°æ®ç»Ÿè®¡</h2>
                        <div class="no-tasks">
                            <h3>åŠ è½½å¤±è´¥</h3>
                            <p>è¯·ç¨åé‡è¯•</p>
                        </div>
                    </div>
                `;
            }
        }
        
        // åˆå§‹åŒ–åº”ç”¨
        function initApp() {
            loadAllTasks();
        }
        
        // åˆå§‹åŒ–åº”ç”¨
        initApp();
    </script>
</body>
</html>